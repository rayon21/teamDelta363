<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Requests</title>
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/font-awesome.min.css">
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <header>
        <img class="logo" src="/img/sfu-logo@2x.png" alt="sfu-logo"/>
    </header>
    <div class="container col-md-10 offset-md-1 wrapper mb-5 col-lg-10" id="app">
        <div class="container col-md-10">
            <div class="row mt-5">
                <h1 class="mt-5">Requests</h1>
            </div>
            <div class="row mt-5">
                <div class="input-group search-group">
                    <span class="fa fa-search"></span>
                    <input type="text" class="form-control" id="search-bar" v-model="searchTerm" placeholder="search"/>
                    <div class="error"></div>
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-md-8 mx-auto">
                    <ul class="nav nav-pills nav-fill">
                        <li class="nav-item"><a href="" v-on:click.stop.prevent="activeStatus='ALL'" v-bind:class="{'active': isActive('ALL')}" class="nav-link">All</a></li>
                        <li class="nav-item"><a href="" v-on:click.stop.prevent="activeStatus='WAITING'" v-bind:class="{'active': isActive('WAITING')}"class="nav-link">Waiting</a></li>
                        <li class="nav-item"><a href="" v-on:click.stop.prevent="activeStatus='APPROVED'" v-bind:class="{'active': isActive('APPROVED')}"class="nav-link">Approved</a></li>
                        <li class="nav-item"><a href="" v-on:click.stop.prevent="activeStatus='REJECTED'" v-bind:class="{'active': isActive('REJECTED')}"class="nav-link">Rejected</a></li>
                    </ul>
                </div>
            </div>
            <div class="row mt-4">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th v-for="column in columns" v-on:click="sortBy(column)" class="clickable">{{column}}</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="request in filteredRequests">
                                <td v-for="value in request" class="clickable" v-on:click="goToRequest(request.requestID)">{{value}}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                    <span class="text-muted" v-if="!filteredRequests.length">No results.</span>
            </div>
        </div>
        <div class="bottom-space"></div>
    </div>
</body>
<script src="/js/jquery-3.2.1.min.js"></script>
<script src="/js/vue.js"></script>
<script>
    function getKeyByValue(object, value) {
        return Object.keys(object).find(key => object[key] === value);
    }
    function isTermInObject(object, term) {
        //debugger;
        for (var prop in object) {
            if (object.hasOwnProperty(prop)) {
                if (object[prop].toLowerCase().includes(term.toLowerCase())) {
                    return true;
                }
            }

        }
        return false;
    }
    var app = new Vue({
        el: '#app',
        data: {
            columns: ["Request ID", "Name", "ID", "Request Date", "Email",
                        "Phone", "Event Name", "Location", "Date", "Status"],
            activeStatus: "ALL",
            searchTerm: "",
            sortKey: "",
            reversed: true,
            requests: [
                {
                    requestID: "170001",
                    requesterName: "Ray Eng",
                    requesterID: "301235622",
                    requestedOnDate: "10/20/17",
                    emailAddress: "raymonde@sfu.ca",
                    phoneNumber: "604-430-1234",
                    eventName: "SSSS Party",
                    Location: "Surrey",
                    eventDates: "12/24/17",
                    status: "WAITING"
                },
                {
                    requestID: "170002",
                    requesterName: "Brian Fraser",
                    requesterID: "301235623",
                    requestedOnDate: "10/20/17",
                    emailAddress: "brian@sfu.ca",
                    phoneNumber: "604-430-1235",
                    eventName: "SSSS Party",
                    Location: "Surrey",
                    eventDates: "12/24/17",
                    status: "WAITING"
                },
                {
                    requestID: "170003",
                    requesterName: "Bill Gates",
                    requesterID: "301235624",
                    requestedOnDate: "10/20/17",
                    emailAddress: "bill@sfu.ca",
                    phoneNumber: "604-430-1235",
                    eventName: "MS Event",
                    Location: "Surrey",
                    eventDates: "12/24/17",
                    status: "APPROVED"
                }

            ]
        },
        methods: {
            isActive: function(status) {
                return this.activeStatus == status;
            },
            sortBy: function(sortKey) {
                this.reversed = !this.reversed;
                this.sortKey = sortKey;
            },
            getColumnValue(columnName) {
                let mappings = {
                    // value: columnName
                    requestID: "Request ID",
                    requesterName: "Name",
                    requesterID: "ID",
                    requestedOnDate: "Request Date",
                    emailAddress: "Email",
                    phoneNumber: "Phone",
                    eventName: "Event Name",
                    Location: "Location",
                    eventDates: "Date",
                    status: "Status"
                }
                return getKeyByValue(mappings, columnName);
            },
            goToRequest(requestID) {
                window.location.assign("/request/" + requestID);
            }
        },
        computed: {
            filteredRequests: {
                cache: false,
                get: function() {
                    return this.requests.filter(request => {
                        return isTermInObject(request, this.searchTerm);
                    }).sort((requestA, requestB) => {
                        return this.reversed ? requestA[this.getColumnValue(this.sortKey)] > requestB[this.getColumnValue(this.sortKey)] :
                            requestA[this.getColumnValue(this.sortKey)] < requestB[this.getColumnValue(this.sortKey)];
                    }).filter(request => {
                        if(this.activeStatus == "ALL") {
                            return true;
                        } else {
                            return request.status.toLowerCase() == this.activeStatus.toLowerCase();
                        }
                    });

                }
            }
        }

    });
</script>
</html>